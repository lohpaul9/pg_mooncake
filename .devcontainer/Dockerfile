FROM mcr.microsoft.com/devcontainers/rust:latest

RUN apt update \
 && apt install -y \
    bison \
    clang-format \
    cmake \
    flex \
    libclang-dev \
    liblz4-dev \
 && rm -rf /var/lib/apt/lists/*

USER vscode

RUN cargo install --locked cargo-pgrx \
 && cargo pgrx init

RUN mkdir -p ~/.duckdb/extension_data/ && \
    chmod 755 ~/.duckdb/extension_data/

RUN echo '\\i /workspaces/pg_mooncake/.devcontainer/.psqlrc' > ~/.psqlrc
